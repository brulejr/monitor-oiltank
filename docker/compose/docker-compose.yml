services:

  monitor-oiltank:
    image: brulejr/monitor-oiltank:latest   # built by Jib
    container_name: monitor-oiltank
    restart: unless-stopped

    environment:
      # Spring profile
      SPRING_PROFILES_ACTIVE: "prod"

      # RTSP URL for the Tapo camera, etc
      OILTANK_CAMERA_RTSP_URL_FILE: "/run/secrets/oiltank_camera_rtsp_url"

      # MQTT connection info
      MQTT_HOST_FILE: "/run/secrets/mqtt_host"
      MQTT_PORT_FILE: "/run/secrets/mqtt_port"
      MQTT_USERNAME_FILE: "/run/secrets/mqtt_username"
      MQTT_PASSWORD_FILE: "/run/secrets/mqtt_password"

      # Optional JVM tuning
      JAVA_OPTS: "-Xms256m -Xmx512m"

    # Map Docker secrets into /run/secrets
    secrets:
      - mqtt_host
      - mqtt_port
      - mqtt_username
      - mqtt_password
      - oiltank_camera_rtsp_url

    # Adjust networking to match your broker / HA environment
    networks:
      - default

secrets:
  mqtt_host:
    file: ../secrets/mqtt_host.txt
  mqtt_port:
    file: ../secrets/mqtt_port.txt
  mqtt_username:
    file: ../secrets/mqtt_username.txt
  mqtt_password:
    file: ../secrets/mqtt_password.txt
  oiltank_camera_rtsp_url:
    file: ../secrets/oiltank_camera_rtsp_url.txt
